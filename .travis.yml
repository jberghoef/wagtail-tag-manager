---
sudo: false
dist: xenial
language: python

node_js:
  - 10

cache:
    pip: true
    npm: true
      directories:
        - ~/.cache

addons:
  chrome: stable
  apt:
    packages:
      - sqlite3
      - libgconf-2-4

matrix:
  include:
    - python: 3.6
      env: TOXENV=lint

    - python: 3.6
      env: TOXENV=py36-django20-wagtail21
    - python: 3.6
      env: TOXENV=py36-django20-wagtail22
    - python: 3.6
      env: TOXENV=py36-django21-wagtail23
    - python: 3.6
      env: TOXENV=py36-django21-wagtail24
    - python: 3.6
      env: TOXENV=py36-django22-wagtail25

    - python: 3.7
      env: TOXENV=py37-django21-wagtail24
    - python: 3.7
      env: TOXENV=py37-django22-wagtail25
    - python: 3.7
      env: TOXENV=py37-django22-wagtail26
    - python: 3.7
      env: TOXENV=py37-django22-wagtail27

    - python: 3.8
      env: TOXENV=py38-django22-wagtail27
    - python: 3.8
      env: TOXENV=py38-django30-wagtail28
    - python: 3.8
      env: TOXENV=py38-django30-wagtail29

install:
  - pip install tox
  - npm ci

jobs:
  include:
    - stage: "unit-tests"
      script: tox -- --nomigrations --reuse-db --ignore tests/browser/ tests/
    - stage: "end to end tests"
      script: $(npm bin)/cypress run --record
